{
  "_class" : "com.zwayam.mongodb.models.CommonQueries",
  "companyId" : "14977",
  "queryName" : "OfferReport",
  "batchLimit" : 10000,
  "query" : "SELECT a.id AS 'Applicant ID', DATE_FORMAT(a.date_applied, '%d-%m-%Y %r') AS 'Applied Date', CONCAT (a.first_name, ' ', a.last_name) AS 'Name', a.phone_no AS 'Candidate Contact No', a.email_id AS 'Candidate Personal Email ID', a.employeeId as 'Employee Id', a.source AS 'Submission Source Type', a.sub_source AS 'Submission Source', a.referrer_email_id as 'Sub Source Email Id', (select fieldValue from c3_offernfitment_custom ofc where ofc.applicantId = a.id and fieldName = 'grade' limit 1) as 'Grade', (select fieldValue from c3_offernfitment_custom ofc where ofc.applicantId = a.id and fieldName = 'TypeOfHire' limit 1) as 'Joining Type', (select fieldValue from c3_offernfitment_custom ofc where ofc.applicantId = a.id and fieldName = 'workerCategory' limit 1) as 'Recruitment Category', a.location AS 'City of Residence', (select fieldValue from c3_offernfitment_custom ofc where ofc.applicantId = a.id and fieldName = 'ssCAT' limit 1) as 'Skill Category', (select fieldValue from c3_offernfitment_custom ofc where ofc.applicantId = a.id and fieldName = 'offertype' limit 1) as 'Offer Type', (select fieldValue from c3_offernfitment_custom ofc where ofc.applicantId = a.id and fieldName = 'hccAllow' limit 1) as 'Other Bonus - High Cost City Allowance', (select fieldValue from c3_offernfitment_custom ofc where ofc.applicantId = a.id and fieldName = 'ssAllow' limit 1) as 'Other Bonus-Special Skill Allowance', ( CASE WHEN LOCATE('\"experience\"', a.applyFieldsObject) > 0 THEN REPLACE( SUBSTRING( a.applyFieldsObject, LOCATE('\"experience\"', a.applyFieldsObject) + 14, LOCATE( '\"', a.applyFieldsObject, LOCATE('\"experience\"', a.applyFieldsObject) + 14 ) - ( LOCATE('\"experience\"', a.applyFieldsObject) + 14 ) ), ',', '' ) ELSE '' END ) AS 'Total Experience', ( CASE WHEN LOCATE('\"trexp\"', a.applyFieldsObject) > 0 THEN REPLACE( SUBSTRING( a.applyFieldsObject, LOCATE('\"trexp\"', a.applyFieldsObject) + 9, LOCATE( '\"', a.applyFieldsObject, LOCATE('\"trexp\"', a.applyFieldsObject) + 9 ) - (LOCATE('\"trexp\"', a.applyFieldsObject) + 9) ), ',', '' ) ELSE '' END ) AS 'Relevant Experience', (select fieldValue from c3_offernfitment_custom ofc where ofc.applicantId = a.id and fieldName = 'specialSkill' limit 1) as 'Special Skills ', (select fieldValue from c3_offernfitment_custom ofc where ofc.applicantId = a.id and fieldName = 'jobTitle' limit 1) as 'Designation', (select fieldValue from c3_offernfitment_custom ofc where ofc.applicantId = a.id and fieldName = 'loc' limit 1) as 'Location', (select DATE_FORMAT(fieldValue, '%d-%m-%Y %r') from c3_offernfitment_custom ofc where ofc.applicantId = a.id and fieldName = 'joiningdate' limit 1) as 'Joining Date', (select DATE_FORMAT(fieldValue,'%M') from c3_offernfitment_custom ofc where ofc.applicantId = a.id and fieldName = 'joiningdate' limit 1) as 'Joining Month', (select DATE_FORMAT(fieldValue, '%d-%m-%Y %r') from c3_offernfitment_custom ofc where ofc.applicantId = a.id and fieldName = 'contractdate' limit 1) as 'Contract End Date', ( SELECT DATE_FORMAT(aa.actedOn, '%d-%m-%Y %r') FROM ApplyAction aa WHERE aa.actionCode = 'Send Offer' AND aa.applyId = a.id ORDER BY aa.actedOn DESC LIMIT 1 ) AS 'Offer Extended Date', ( SELECT DATE_FORMAT(aa.actedOn, '%M') FROM ApplyAction aa WHERE aa.actionCode = 'Send Offer' AND aa.applyId = a.id ORDER BY aa.actedOn DESC LIMIT 1 ) AS 'Offer Extended Month', ( SELECT DATE_FORMAT(aa.actedOn, '%d-%m-%Y %r') FROM ApplyAction aa WHERE aa.actionCode = 'Create Fitment' AND aa.applyId = a.id ORDER BY aa.actedOn DESC LIMIT 1 ) AS 'Offer Created Date', ( SELECT DATE_FORMAT(aa.actedOn, '%M') FROM ApplyAction aa WHERE aa.actionCode = 'Create Fitment' AND aa.applyId = a.id ORDER BY aa.actedOn DESC LIMIT 1 ) AS 'Offer Created Month', ( SELECT DATE_FORMAT(aa.actedOn, '%d-%m-%Y %r') FROM ApplyAction aa WHERE aa.actionCode = 'Send Offer' AND aa.applyId = a.id ORDER BY aa.id desc LIMIT 1 ) AS 'Offer Sent Date', ( SELECT u.username FROM c3_user u WHERE u.id IN ( Select aa.actedBy from ApplyAction aa where aa.actionCode = 'Send Offer' AND aa.applyId = a.id order by aa.id DESC ) LIMIT 1 ) AS 'Offer Sent By', ( SELECT DATE_FORMAT(aa.actedOn, '%M') FROM ApplyAction aa WHERE aa.actionCode = 'Send Offer' AND aa.applyId = a.id ORDER BY aa.actedOn LIMIT 1 ) AS 'Offer Sent Month', ( SELECT DATE_FORMAT(aa.actedOn, '%d-%m-%Y %r') FROM ApplyAction aa WHERE aa.actionCode = 'Send Offer' AND aa.applyId = a.id ORDER BY aa.actedOn DESC LIMIT 1 ) AS 'Offer Revised Date', ( SELECT DATE_FORMAT(aa.actedOn, '%M') FROM ApplyAction aa WHERE aa.actionCode = 'Send Offer' AND aa.applyId = a.id ORDER BY aa.actedOn DESC LIMIT 1 ) AS 'Offer Revised Month', ( SELECT DATE_FORMAT(aa.actedOn, '%d-%m-%Y %r') FROM ApplyAction aa WHERE aa.actionCode = 'Accept Offer' AND aa.applyId = a.id ORDER BY aa.actedOn DESC LIMIT 1 ) AS 'Offer Accepted Date', ( SELECT DATE_FORMAT(aa.actedOn, '%M') FROM ApplyAction aa WHERE aa.actionCode = 'Accept Offer' AND aa.applyId = a.id ORDER BY aa.actedOn DESC LIMIT 1 ) AS 'Offer Accepted Month', a.current_ctc AS 'Current CTC', a.expected_ctc AS 'Expected CTC', (select fieldValue from c3_offernfitment_custom ofc where ofc.applicantId = a.id and fieldName = 'max' limit 1) as 'Benchmark Salary', (select fieldValue from c3_offernfitment_custom ofc where ofc.applicantId = a.id and fieldName = 'ctc' limit 1) as 'Offered CTC', (select fieldValue from c3_offernfitment_custom ofc where ofc.applicantId = a.id and fieldName = 'agross1' limit 1) as 'Annual Gross', (select fieldValue from c3_offernfitment_custom ofc where ofc.applicantId = a.id and fieldName = 'deviation' limit 1) as 'Deviation %', ( CASE WHEN LOCATE('\"number16\"', a.applyFieldsObject) > 0 THEN REPLACE( SUBSTRING( a.applyFieldsObject, LOCATE('\"number16\"', a.applyFieldsObject) + 12, LOCATE( '\"', a.applyFieldsObject, LOCATE('\"number16\"', a.applyFieldsObject) + 12 ) - (LOCATE('\"number16\"', a.applyFieldsObject) + 12) ), ',', '' ) ELSE '' END ) AS 'Notice Period/Joining Time', (select fieldValue from c3_offernfitment_custom ofc where ofc.applicantId = a.id and fieldName = 'npyesno' limit 1) as 'Benchmark Salary', (select if((select fieldValue from c3_offernfitment_custom ofc where ofc.applicantId = a.id and fieldName = 'jbyesno' limit 1) = 'Yes',(select fieldValue from c3_offernfitment_custom ofc where ofc.applicantId = a.id and fieldName = 'jb' limit 1),'')) as 'Sign-On Bonus', (select if((select fieldValue from c3_offernfitment_custom ofc where ofc.applicantId = a.id and fieldName = 'relbyesno' limit 1) = 'Yes',(select fieldValue from c3_offernfitment_custom ofc where ofc.applicantId = a.id and fieldName = 'relb' limit 1),'')) as 'Relocation Amount', (select if((select fieldValue from c3_offernfitment_custom ofc where ofc.applicantId = a.id and fieldName = 'retbyesno' limit 1) = 'Yes',(select fieldValue from c3_offernfitment_custom ofc where ofc.applicantId = a.id and fieldName = 'retb' limit 1),'')) as 'Retention Bonus Amount', (select fieldValue from c3_offernfitment_custom ofc where ofc.applicantId = a.id and fieldName = 'l1code' limit 1) as 'L1 Benchmark value', (select fieldValue from c3_offernfitment_custom ofc where ofc.applicantId = a.id and fieldName = 'l2code' limit 1) as 'L2 Benchmark value', (select u.username from ApplyAction AA join c3_user u on AA.actedBy=u.id where AA.actionCode = 'Create Fitment' and AA.applyId = a.id limit 1) AS 'Recruiter Name', ( select group_concat(u.employeeId) from c3_user u where u.id in ( select jc.user_id from c3_job_collaboration jc where u.id = jc.user_id and jc.job_id = j.id ) limit 1 ) as 'Recruiter Code', (select fieldValue from c3_offernfitment_custom ofc where ofc.applicantId = a.id and fieldName = 'recruiterEmail' limit 1) as 'Recruiter Email', ( SELECT rfv.value FROM c3_requisition_field_values rfv INNER JOIN c3_requisition_fields rf ON rfv.requisition_field_id = rf.id AND rf.field_name = 'Reference Number' WHERE rfv.requisition_id = j.id LIMIT 1 ) AS 'Indent Number', ( SELECT rfv.value FROM c3_requisition_field_values rfv INNER JOIN c3_requisition_fields rf ON rfv.requisition_field_id = rf.id AND rf.field_name = 'Requisition Title' WHERE rfv.requisition_id = j.id LIMIT 1 ) AS 'Title', ( SELECT rfv.value FROM c3_requisition_field_values rfv INNER JOIN c3_requisition_fields rf ON rfv.requisition_field_id = rf.id AND rf.field_name = 'Organization Unit' WHERE rfv.requisition_id = j.id LIMIT 1 ) AS 'OU', ( SELECT rfv.value FROM c3_requisition_field_values rfv INNER JOIN c3_requisition_fields rf ON rfv.requisition_field_id = rf.id AND rf.field_name = 'Business Unit' WHERE rfv.requisition_id = j.id LIMIT 1 ) AS 'BU', ( SELECT rfv.value FROM c3_requisition_field_values rfv INNER JOIN c3_requisition_fields rf ON rfv.requisition_field_id = rf.id AND rf.field_name = 'Department Unit' WHERE rfv.requisition_id = j.id LIMIT 1 ) AS 'Department Unit', ( SELECT rfv.value FROM c3_requisition_field_values rfv INNER JOIN c3_requisition_fields rf ON rfv.requisition_field_id = rf.id AND rf.field_name = 'Client Name' WHERE rfv.requisition_id = j.id LIMIT 1 ) AS 'Customer', ( SELECT rfv.value FROM c3_requisition_field_values rfv INNER JOIN c3_requisition_fields rf ON rfv.requisition_field_id = rf.id AND rf.field_name = 'Opportuinity/Project Name' WHERE rfv.requisition_id = j.id LIMIT 1 ) AS 'Project/Opportunity Name', ( SELECT rfv.value FROM c3_requisition_field_values rfv INNER JOIN c3_requisition_fields rf ON rfv.requisition_field_id = rf.id AND rf.field_name = 'Opportuinity/Project Stage' WHERE rfv.requisition_id = j.id LIMIT 1 ) AS 'Opportunity Stage', ( SELECT rfv.value FROM c3_requisition_field_values rfv INNER JOIN c3_requisition_fields rf ON rfv.requisition_field_id = rf.id AND rf.field_name = 'Indent Category' WHERE rfv.requisition_id = j.id LIMIT 1 ) AS 'Indent Category', ( SELECT rfv.value FROM c3_requisition_field_values rfv INNER JOIN c3_requisition_fields rf ON rfv.requisition_field_id = rf.id AND rf.field_name = 'Indent Classification' WHERE rfv.requisition_id = j.id LIMIT 1 ) AS 'Indent Classification', ( SELECT rfv.value FROM c3_requisition_field_values rfv INNER JOIN c3_requisition_fields rf ON rfv.requisition_field_id = rf.id AND rf.field_name = 'Billing Status' WHERE rfv.requisition_id = j.id LIMIT 1 ) AS 'Indent Billing Status', a.current_status AS 'Status', ( SELECT SUBSTRING_INDEX(tag_value, ':', - 1) FROM c3_application_notes WHERE applicant_id = a.id AND tag_name = 'Offer-Rejected-Tag' ORDER BY added_on DESC LIMIT 1 ) AS 'Refused Offer Comments', ( CASE WHEN LOCATE('\"EType\"', a.applyFieldsObject) > 0 THEN REPLACE( SUBSTRING( a.applyFieldsObject, LOCATE('\"EType\"', a.applyFieldsObject) + 9, LOCATE( '\"', a.applyFieldsObject, LOCATE('\"EType\"', a.applyFieldsObject) + 9 ) - (LOCATE('\"EType\"', a.applyFieldsObject) + 9) ), ',', '' ) ELSE '' END ) AS 'Employment Type', ( CASE WHEN LOCATE('\"leaveDate\"', a.applyFieldsObject) > 0 THEN REPLACE( SUBSTRING( a.applyFieldsObject, LOCATE('\"leaveDate\"', a.applyFieldsObject) + 13, LOCATE( '\"', a.applyFieldsObject, LOCATE('\"leaveDate\"', a.applyFieldsObject) + 13 ) - ( LOCATE('\"leaveDate\"', a.applyFieldsObject) + 13 ) ), ',', '' ) ELSE '' END ) AS 'Leaving Date', ( CASE WHEN LOCATE('\"leaveComments\"', a.applyFieldsObject) > 0 THEN REPLACE( SUBSTRING( a.applyFieldsObject, LOCATE('\"leaveComments\"', a.applyFieldsObject) + 17, LOCATE( '\"', a.applyFieldsObject, LOCATE('\"leaveComments\"', a.applyFieldsObject) + 17 ) - ( LOCATE('\"leaveComments\"', a.applyFieldsObject) + 17 ) ), ',', '' ) ELSE '' END ) AS 'Leaving Comments' from c3_job_application a join c3_job j on a.job_id = j.id $conditions$ GROUP BY a.id",
  "conditions" : "where a.current_stage = 'Joining' and a.is_active = 1 AND a.company_id = (select distinct companyId from UserRoleGroup where user_id= $userId$ and roleCode = 'Admin') ",
  "filterConditions" : {
      "fromDate" : "a.joined_date >= '$fromDate$' ",
      "toDate" : "a.joined_date <= '$toDate$' ",
      "department" : " j.deptFullCode in ($department$) ",
      "location" : "j.location in ($location$) ",
      "hiringManager" : "j.hiring_manager in ($hiringManager$) ",
      "recruiter" : "jcol.user_id in ($recruiter$) ",
      "jobStatus" : "j.status = '$jobStatus$'"
  },
  "joiningTables" : {
      "c3_job_collaboration" : " join c3_job_collaboration jcol on j.id = jcol.job_id "
  },
  "fileName" : "OfferReport.csv",
  "displayName" : "OfferReport (.csv)"
}
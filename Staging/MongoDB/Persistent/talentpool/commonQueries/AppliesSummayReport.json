{
    "_class": "com.zwayam.mongodb.models.CommonQueries",
    "Instance": "staging",
    "companyId": "14977",
    "queryName": "AppliesSummayReport",
    "batchLimit": 5000,
    "query": "SELECT a.id as 'Candidate ID',a.first_name as 'First Name',a.last_name as 'Last Name',a.email_id as 'Email Id',a.employeeId as 'Employee Id',j.job_code as 'Job Code',j.job_title as 'Job Title',DATE_FORMAT(a.date_applied, '%Y-%m-%d %H:%i') as 'Date Applied',( CASE WHEN LOCATE('\"number16\"', a.applyFieldsObject) > 0 THEN REPLACE( SUBSTRING( a.applyFieldsObject, LOCATE('\"number16\"', a.applyFieldsObject) + 12, LOCATE( '\"', a.applyFieldsObject, LOCATE('\"number16\"', a.applyFieldsObject) + 12 ) - (LOCATE('\"number16\"', a.applyFieldsObject) + 12) ), ',', '' ) ELSE '' END ) AS 'Notice Period/Joining Time',a.phone_no as 'Phone No',a.experience as 'Experience',a.location as 'Location',a.current_status as 'Application Status',(select if(a.current_status in ('L2-Interview Scheduled', 'L3-Interview Scheduled', 'Client-Interview Scheduled', 'L1A-Interview Scheduled', 'L1A-Interview Selected', 'HR-Interview Scheduled', 'L1-Interview Scheduled'),(SELECT u.username FROM c3_application_interview_schedule ais JOIN c3_user u ON u.id = ais.scheduled_by WHERE ais.applicantion_id = a.id AND ais.status IN ('C' , 'I', 'M', 'S', 'R') ORDER BY ais.id DESC LIMIT 1),\"\")) as 'Interview Scheduled By', (select if(a.current_status in ('L2-Interview Scheduled', 'L3-Interview Scheduled', 'Client-Interview Scheduled', 'L1A-Interview Scheduled', 'L1A-Interview Selected', 'HR-Interview Scheduled', 'L1-Interview Scheduled'),(select DATE_FORMAT(ais.interview_from_time_1, '%e-%b-%Y') from c3_application_interview_schedule ais where ais.applicantion_id = a.id and ais.status in ('C','I','M','S','R') order by ais.id desc limit 1),\"\")) as 'Interview Time',(select applyAction.actedOn FROM ApplyAction applyAction WHERE applyAction.applyId =a.id and  applyAction.actionCode='Send Offer' order by applyAction.id desc limit 1) as 'Send Offer On',(select applyAction.actedOn FROM ApplyAction applyAction WHERE applyAction.applyId =a.id and  applyAction.actionCode='Accept Offer' order by applyAction.id desc limit 1) as 'Offer Accepted On',REPLACE((case when a.current_status='Rejected' then (select tag_value from c3_application_notes where applicant_id = a.id and tag_name='Reject-Tag' order by id desc limit 1) else 'Not Applicable' end),'\n','-') as 'Rejection Notes',a.source as 'Source',a.sub_source as 'Sub-Source',a.referrer_email_id as 'Referrer Email',(select username from c3_user where id = a.modified_by_user_id)as 'Modified By', CASE WHEN a.current_status IN ('Shortlisted','HM Shortlisted', 'L1 Tech-Interview Scheduled', 'L2 Tech-Interview Scheduled', 'L3 Tech-Interview Scheduled', 'Recruiter Screen-Interview Scheduled', 'Sales Screen-Interview Scheduled', 'Client Interview-Interview Scheduled', 'HR Discussion-Interview Scheduled', 'L1 Tech-Interview Selected', 'L2 Tech-Interview Selected', 'L3 Tech-Interview Selected', 'Recruiter Screen-Interview Selected','Sales Screen-Interview Selected', 'Client Interview-Interview Selected', 'HR Discussion-Interview Selected','Selected','L1 Tech-Interviewed','Document Requested') THEN 'Shortlist' WHEN a.current_status IN ('Interview Rejected','HR Discussion-Interview Rejected','L1 Tech-Interview Rejected', 'L2 Tech-Interview Rejected', 'L3 Tech-Interview Rejected', 'Recruiter Screen-Interview Rejected', 'Sales Screen-Interview Rejected', 'Client Interview-Interview Rejected','Rejected','Not Selected','Recruiter Rejected','HM Rejected') THEN 'Rejected' WHEN a.current_status in ('Offer Sent', 'Offer Rejected', 'Offer Accepted', 'Fitment Initiated', 'Fitment L1 Pending', 'Fitment L1 Approved', 'Fitment L1 Rejected', 'Offer Withdrawn', 'Offer Revoked','Joined','Fitment L2 Approved','Fitment L2 Pending','Fitment L2 Rejected','Approval Requested','Approval Rejected') THEN 'Offer' ELSE ( 'Pending' ) END AS 'Recommendation',( SELECT rfv.value FROM c3_requisition_field_values rfv INNER JOIN c3_requisition_fields rf ON rfv.requisition_field_id = rf.id AND rf.field_name = 'Organization Unit' WHERE rfv.requisition_id = j.id LIMIT 1 ) AS 'OU', ( SELECT rfv.value FROM c3_requisition_field_values rfv INNER JOIN c3_requisition_fields rf ON rfv.requisition_field_id = rf.id AND rf.field_name = 'Business Unit' WHERE rfv.requisition_id = j.id LIMIT 1 ) AS 'BU', ( SELECT rfv.value FROM c3_requisition_field_values rfv INNER JOIN c3_requisition_fields rf ON rfv.requisition_field_id = rf.id AND rf.field_name = 'Department Unit' WHERE rfv.requisition_id = j.id LIMIT 1 ) AS 'DU',j.reference_number as 'Reference Number',(case when j.status = 0 then 'Closed' when  j.status = 1 then 'Open' when j.status = 2 then 'Hidden' end) as 'Job Status',( SELECT username FROM c3_user WHERE id = ( SELECT user_id FROM c3_job_collaboration jc WHERE jc.job_id = j.id AND jc.ROLE = 'Recruiter' limit 1 ) ) AS 'Recruiter',( CASE WHEN LOCATE('\"leaveDate\"', a.applyFieldsObject) > 0 THEN REPLACE( SUBSTRING( a.applyFieldsObject, LOCATE('\"leaveDate\"', a.applyFieldsObject) + 13, LOCATE( '\"', a.applyFieldsObject, LOCATE('\"leaveDate\"', a.applyFieldsObject) + 13 ) - (LOCATE('\"leaveDate\"', a.applyFieldsObject) + 13) ), ',', '' ) ELSE '' END ) AS 'Leaving Date',( CASE WHEN LOCATE('\"leaveComments\"', a.applyFieldsObject) > 0 THEN REPLACE( SUBSTRING( a.applyFieldsObject, LOCATE('\"leaveComments\"', a.applyFieldsObject) + 17, LOCATE( '\"', a.applyFieldsObject, LOCATE('\"leaveComments\"', a.applyFieldsObject) + 17 ) - (LOCATE('\"leaveComments\"', a.applyFieldsObject) + 17) ), ',', '' ) ELSE '' END ) AS 'Leaving Comments',SUBSTRING(a.applyFieldsObject, LOCATE('\"personally\"', a.applyFieldsObject) + length('\"personally\":\"'), LOCATE(',', a.applyFieldsObject, LOCATE('\"personally\"', a.applyFieldsObject)) - LOCATE('\"personally\"', a.applyFieldsObject) - (length('\"personally\":\"') + 1)) AS 'Do you know the candidate Personally?',SUBSTRING(a.applyFieldsObject, LOCATE('\"professionally\"', a.applyFieldsObject) + length('\"professionally\":\"'), LOCATE(',', a.applyFieldsObject, LOCATE('\"professionally\"', a.applyFieldsObject)) - LOCATE('\"professionally\"', a.applyFieldsObject) - (length('\"professionally\":\"') + 1)) AS 'Do you know the candidate Professionally?',SUBSTRING(a.applyFieldsObject, LOCATE('\"pasttogetherwork\"', a.applyFieldsObject) + length('\"pasttogetherwork\":\"'), LOCATE(',', a.applyFieldsObject, LOCATE('\"pasttogetherwork\"', a.applyFieldsObject)) - LOCATE('\"pasttogetherwork\"', a.applyFieldsObject) - (length('\"pasttogetherwork\":\"') + 1)) AS 'Was he/she working with you in one of your past organizations?',SUBSTRING(a.applyFieldsObject, LOCATE('\"directrelation\"', a.applyFieldsObject) + length('\"directrelation\":\"'), LOCATE(',', a.applyFieldsObject, LOCATE('\"directrelation\"', a.applyFieldsObject)) - LOCATE('\"directrelation\"', a.applyFieldsObject) - (length('\"directrelation\":\"') + 1)) AS 'Were you or He (She) had a direct reporting relationship?',SUBSTRING(a.applyFieldsObject, LOCATE('\"future\"', a.applyFieldsObject) + length('\"future\":\"'), LOCATE(',', a.applyFieldsObject, LOCATE('\"future\"', a.applyFieldsObject)) - LOCATE('\"future\"', a.applyFieldsObject) - (length('\"future\":\"') + 1)) AS 'Do you think the referee would be a good fit for Persistent?',SUBSTRING(a.applyFieldsObject, LOCATE('\"remark\"', a.applyFieldsObject) + length('\"remark\":\"'), LOCATE(',', a.applyFieldsObject, LOCATE('\"remark\"', a.applyFieldsObject)) - LOCATE('\"remark\"', a.applyFieldsObject) - (length('\"remark\":\"') + 1)) as 'Remarks',date_format(a.modified_date,\"%d-%m-%Y\") as 'Last Modified Date' from c3_job_application a join c3_job j on a.job_id = j.id left join c3_department d on j.department_id = d.id $conditions$ ",
    "fileName": "companyAppliesSummayReport.csv",
    "displayName": "Applies Summay Report (.csv)",
    "conditions": "where a.is_active =1 and a.company_id =(select companyId from UserRoleGroup where user_id= $userId$ and roleCode != 'Job Collaborator' limit 1) and ((j.department_id IN (SELECT DISTINCT Department.id FROM c3_department Department, UserRoleGroup UserRoleGroup WHERE UserRoleGroup.user_id = $userId$ AND UserRoleGroup.companyId = $companyId$ AND Department.company_id = $companyId$ AND UserRoleGroup.roleCode IN (SELECT DISTINCT Role.roleCode FROM Role Role, UserRoleRightDefinition UserRoleRightDefinition WHERE Role.roleCode IN (UserRoleRightDefinition.roleCode) AND Role.companyId = $companyId$ AND Role.scope = 'Department') AND Department.departmentFullcode LIKE CONCAT(UserRoleGroup.deptFullCode, '%')) or j.id in (select job_id from c3_job_collaboration where user_id=$userId$)) or a.company_id = (select companyId from UserRoleGroup where user_id= $userId$ and roleCode = 'Analytics Team'))",
    "filterConditions": {
        "fromDate": "a.date_applied >= '$fromDate$' ",
        "toDate": "a.date_applied <= '$toDate$' ",
        "recruiter": "jcol.user_id in ($recruiter$) ",
        "location": "j.location in ($location$) ",
        "department": " j.deptFullCode in ($department$) ",
        "hiringManager": "j.hiring_manager in ($hiringManager$) ",
        "jobStatus": "j.status = '$jobStatus$'"
    },
    "joiningTables": {
        "c3_job_collaboration": " join c3_job_collaboration jcol on j.id = jcol.job_id "
    }
}
{
    "_class" : "com.zwayam.mongodb.models.CommonQueries",
    "Instance" : "staging",
    "companyId" : "14977",
    "queryName" : "AppliesReport",
    "batchLimit" : 5000,
    "query" : "SELECT a.id as 'Candidate ID', a.first_name as 'First Name', a.last_name as 'Last Name', a.email_id as 'Email Id', a.employeeId as 'Employee Id', j.job_code as 'Job Code', j.job_title as 'Job Title', DATE_FORMAT(a.date_applied, '%Y-%m-%d %H:%i') as 'Date Applied', ( CASE WHEN LOCATE('\"number16\"', a.applyFieldsObject) > 0 THEN REPLACE( SUBSTRING( a.applyFieldsObject, LOCATE('\"number16\"', a.applyFieldsObject) + 12, LOCATE( '\"', a.applyFieldsObject, LOCATE('\"number16\"', a.applyFieldsObject) + 12 ) - (LOCATE('\"number16\"', a.applyFieldsObject) + 12) ), ',', '' ) ELSE '' END ) AS 'Notice Period/Joining Time', a.phone_no as 'Phone No', a.experience as 'Experience', a.location as 'Candidate Location', a.current_status as 'Application Status', (select substring(tag_value,position(\"HM Screener: </b>\" in tag_value)+17,length(tag_value)) from c3_application_notes where applicant_id = a.id and tag_name = 'HM Screening' order by id desc limit 1) as 'HM Screener Name', (select date_format(actedOn,\"%d-%m-%Y\") from ApplyAction AA where AA.applyId = a.id and AA.actionCode = 'HM Screening' order by id desc limit 1) as 'HM Screening Acted On', (select group_concat(distinct u.username) from c3_application_interview_schedule ais join c3_application_interviewer ai on ais.id = ai.interview_id join c3_user u on ai.user_id=u.id where ais.applicantion_id = a.id and ais.interview_round = 'L1' and ais.status in ('C','I','F','M','S','R','D') order by ais.id desc) as 'L1 Interviewer Name', (select date_format(ais.interview_from_time_1,\"%d-%m-%Y\")from c3_application_interview_schedule ais where ais.applicantion_id = a.id and ais.interview_round = 'L1' and ais.status in ('C','I','F','M','S','R','D') order by ais.id desc limit 1) as 'L1 Interview Date', (select group_concat(distinct u.username) from c3_application_interview_schedule ais join c3_application_interviewer ai on ais.id = ai.interview_id join c3_user u on ai.user_id=u.id where ais.applicantion_id = a.id and ais.interview_round = 'L1A' and ais.status in ('C','I','F','M','S','R','D') order by ais.id desc) as 'L1A Interviewer Name', (select date_format(ais.interview_from_time_1,\"%d-%m-%Y\")from c3_application_interview_schedule ais where ais.applicantion_id = a.id and ais.interview_round = 'L1A' and ais.status in ('C','I','F','M','S','R','D') order by ais.id desc limit 1) as 'L1A Interview Date', (select group_concat(distinct u.username) from c3_application_interview_schedule ais join c3_application_interviewer ai on ais.id = ai.interview_id join c3_user u on ai.user_id=u.id where ais.applicantion_id = a.id and ais.interview_round = 'L2' and ais.status in ('C','I','F','M','S','R','D') order by ais.id desc) as 'L2 Interviewer Name', (select date_format(ais.interview_from_time_1,\"%d-%m-%Y\")from c3_application_interview_schedule ais where ais.applicantion_id = a.id and ais.interview_round = 'L2' and ais.status in ('C','I','F','M','S','R','D') order by ais.id desc limit 1) as 'L2 Interview Date', (select group_concat(distinct u.username) from c3_application_interview_schedule ais join c3_application_interviewer ai on ais.id = ai.interview_id join c3_user u on ai.user_id=u.id where ais.applicantion_id = a.id and ais.interview_round = 'L3' and ais.status in ('C','I','F','M','S','R','D') order by ais.id desc) as 'L3 Interviewer Name', (select date_format(ais.interview_from_time_1,\"%d-%m-%Y\")from c3_application_interview_schedule ais where ais.applicantion_id = a.id and ais.interview_round = 'L3' and ais.status in ('C','I','F','M','S','R','D') order by ais.id desc limit 1) as 'L3 Interview Date', (select group_concat(distinct u.username) from c3_application_interview_schedule ais join c3_application_interviewer ai on ais.id = ai.interview_id join c3_user u on ai.user_id=u.id where ais.applicantion_id = a.id and ais.interview_round = 'Client' and ais.status in ('C','I','F','M','S','R','D') order by ais.id desc) as 'Client Interviewer Name', (select date_format(ais.interview_from_time_1,\"%d-%m-%Y\")from c3_application_interview_schedule ais where ais.applicantion_id = a.id and ais.interview_round = 'Client' and ais.status in ('C','I','F','M','S','R','D') order by ais.id desc limit 1) as 'Client Interview Date', (select group_concat(distinct u.username) from c3_application_interview_schedule ais join c3_application_interviewer ai on ais.id = ai.interview_id join c3_user u on ai.user_id=u.id where ais.applicantion_id = a.id and ais.interview_round = 'HR' and ais.status in ('C','I','F','M','S','R','D') order by ais.id desc) as 'HR Interviewer Name', (select date_format(ais.interview_from_time_1,\"%d-%m-%Y\")from c3_application_interview_schedule ais where ais.applicantion_id = a.id and ais.interview_round = 'HR' and ais.status in ('C','I','F','M','S','R','D') order by ais.id desc limit 1) as 'HR Interview Date', (select group_concat(distinct jc.emailId) from c3_job_collaboration jc where role = 'Primary Recruiter' and jc.job_id = a.job_id) as 'Recruiter', (select group_concat(distinct jc.emailId) from c3_job_collaboration jc where role = 'Collaborator' and jc.job_id = a.job_id) as 'Collaborator', (select date_format(actedOn,\"%d-%m-%Y\") from ApplyAction AA where AA.applyId = a.id and AA.actionCode = 'Create Fitment' limit 1) as 'First offer created on', (select date_format(actedOn,\"%d-%m-%Y\") from ApplyAction AA where AA.applyId = a.id and AA.actionCode in ('Create Fitment','Modify Fitment') order by id desc limit 1) as 'Final offer created on', (select date_format(actedOn,\"%d-%m-%Y\") from ApplyAction AA where AA.applyId = a.id and AA.actionCode in ('Accept Offer','Reject Offer') order by id desc limit 1) as 'Offer Accept/Reject on', j.location as 'Indent Location', ( select applyAction.actedOn FROM ApplyAction applyAction WHERE applyAction.applyId = a.id and applyAction.actionCode = 'Send Offer' order by applyAction.id desc limit 1 ) as 'Send Offer On', ( select applyAction.actedOn FROM ApplyAction applyAction WHERE applyAction.applyId = a.id and applyAction.actionCode = 'Accept Offer' order by applyAction.id desc limit 1 ) as 'Offer Accepted On', REPLACE( ( case when a.current_status = 'Rejected' then ( select tag_value from c3_application_notes where applicant_id = a.id and tag_name = 'Reject-Tag' order by id desc limit 1 ) else 'Not Applicable' end ), '\n', '-' ) as 'Rejection Notes', a.source as 'Source', a.referrer_email_id as 'Referrer Email', ( select username from c3_user where id = a.modified_by_user_id ) as 'Modified By', CASE WHEN a.current_status IN ( 'Shortlisted', 'HM Shortlisted', 'L1 Tech-Interview Scheduled', 'L2 Tech-Interview Scheduled', 'L3 Tech-Interview Scheduled', 'Recruiter Screen-Interview Scheduled', 'Sales Screen-Interview Scheduled', 'Client Interview-Interview Scheduled', 'HR Discussion-Interview Scheduled', 'L1 Tech-Interview Selected', 'L2 Tech-Interview Selected', 'L3 Tech-Interview Selected', 'Recruiter Screen-Interview Selected', 'Sales Screen-Interview Selected', 'Client Interview-Interview Selected', 'HR Discussion-Interview Selected', 'Selected', 'L1 Tech-Interviewed', 'Document Requested' ) THEN 'Shortlist' WHEN a.current_status IN ( 'Interview Rejected', 'HR Discussion-Interview Rejected', 'L1 Tech-Interview Rejected', 'L2 Tech-Interview Rejected', 'L3 Tech-Interview Rejected', 'Recruiter Screen-Interview Rejected', 'Sales Screen-Interview Rejected', 'Client Interview-Interview Rejected', 'Rejected', 'Not Selected', 'Recruiter Rejected', 'HM Rejected' ) THEN 'Rejected' WHEN a.current_status in ( 'Offer Sent', 'Offer Rejected', 'Offer Accepted', 'Fitment Initiated', 'Fitment L1 Pending', 'Fitment L1 Approved', 'Fitment L1 Rejected', 'Offer Withdrawn', 'Offer Revoked', 'Joined', 'Fitment L2 Approved', 'Fitment L2 Pending', 'Fitment L2 Rejected', 'Approval Requested', 'Approval Rejected' ) THEN 'Offer' ELSE ('Pending') END AS 'Recommendation', d.department_name as 'Dept. Name', j.reference_number as 'Reference Number', ( case when j.status = 0 then 'Closed' when j.status = 1 then 'Open' when j.status = 2 then 'Hidden' end ) as 'Job Status', ( SELECT username FROM c3_user WHERE id = ( SELECT user_id FROM c3_job_collaboration jc WHERE jc.job_id = j.id AND jc.ROLE = 'Recruiter' limit 1 ) ) AS 'Recruiter', ( CASE WHEN LOCATE('\"leaveDate\"', a.applyFieldsObject) > 0 THEN REPLACE( SUBSTRING( a.applyFieldsObject, LOCATE('\"leaveDate\"', a.applyFieldsObject) + 13, LOCATE( '\"', a.applyFieldsObject, LOCATE('\"leaveDate\"', a.applyFieldsObject) + 13 ) - ( LOCATE('\"leaveDate\"', a.applyFieldsObject) + 13 ) ), ',', '' ) ELSE '' END ) AS 'Leaving Date', ( CASE WHEN LOCATE('\"leaveComments\"', a.applyFieldsObject) > 0 THEN REPLACE( SUBSTRING( a.applyFieldsObject, LOCATE('\"leaveComments\"', a.applyFieldsObject) + 17, LOCATE( '\"', a.applyFieldsObject, LOCATE('\"leaveComments\"', a.applyFieldsObject) + 17 ) - ( LOCATE('\"leaveComments\"', a.applyFieldsObject) + 17 ) ), ',', '' ) ELSE '' END ) AS 'Leaving Comments', SUBSTRING( a.applyFieldsObject, LOCATE('\"personally\"', a.applyFieldsObject) + length('\"personally\":\"'), LOCATE( ',', a.applyFieldsObject, LOCATE('\"personally\"', a.applyFieldsObject) ) - LOCATE('\"personally\"', a.applyFieldsObject) - (length('\"personally\":\"') + 1) ) AS 'Do you know the candidate Personally?', SUBSTRING( a.applyFieldsObject, LOCATE('\"professionally\"', a.applyFieldsObject) + length('\"professionally\":\"'), LOCATE( ',', a.applyFieldsObject, LOCATE('\"professionally\"', a.applyFieldsObject) ) - LOCATE('\"professionally\"', a.applyFieldsObject) - (length('\"professionally\":\"') + 1) ) AS 'Do you know the candidate Professionally?', SUBSTRING( a.applyFieldsObject, LOCATE('\"pasttogetherwork\"', a.applyFieldsObject) + length('\"pasttogetherwork\":\"'), LOCATE( ',', a.applyFieldsObject, LOCATE('\"pasttogetherwork\"', a.applyFieldsObject) ) - LOCATE('\"pasttogetherwork\"', a.applyFieldsObject) - (length('\"pasttogetherwork\":\"') + 1) ) AS 'Was he/she working with you in one of your past organizations?', SUBSTRING( a.applyFieldsObject, LOCATE('\"directrelation\"', a.applyFieldsObject) + length('\"directrelation\":\"'), LOCATE( ',', a.applyFieldsObject, LOCATE('\"directrelation\"', a.applyFieldsObject) ) - LOCATE('\"directrelation\"', a.applyFieldsObject) - (length('\"directrelation\":\"') + 1) ) AS 'Were you or He (She) had a direct reporting relationship?', SUBSTRING( a.applyFieldsObject, LOCATE('\"future\"', a.applyFieldsObject) + length('\"future\":\"'), LOCATE( ',', a.applyFieldsObject, LOCATE('\"future\"', a.applyFieldsObject) ) - LOCATE('\"future\"', a.applyFieldsObject) - (length('\"future\":\"') + 1) ) AS 'Do you think the referee would be a good fit for Persistent?', SUBSTRING( a.applyFieldsObject, LOCATE('\"remark\"', a.applyFieldsObject) + length('\"remark\":\"'), LOCATE( ',', a.applyFieldsObject, LOCATE('\"remark\"', a.applyFieldsObject) ) - LOCATE('\"remark\"', a.applyFieldsObject) - (length('\"remark\":\"') + 1) ) as 'Remarks' from c3_job_application a join c3_job j on a.job_id = j.id left join c3_department d on j.department_id = d.id $conditions$ ",
    "fileName" : "companyAppliesReport.csv",
    "displayName" : "Applies Report (.csv)",
    "conditions" : "where a.is_active =1 AND j.deptFullCode not like 'persistent.Leadership%' and a.company_id =(select companyId from UserRoleGroup where user_id= $userId$ and roleCode != 'Job Collaborator' limit 1)",
    "filterConditions" : {
        "fromDate" : "a.date_applied >= '$fromDate$' ",
        "toDate" : "a.date_applied <= '$toDate$' ",
        "recruiter" : "jcol.user_id in ($recruiter$) ",
        "location" : "j.location in ($location$) ",
        "department" : " j.deptFullCode in ($department$) ",
        "hiringManager" : "j.hiring_manager in ($hiringManager$) ",
        "jobStatus" : "j.status = '$jobStatus$'"
    },
    "joiningTables" : {
        "c3_job_collaboration" : " join c3_job_collaboration jcol on j.id = jcol.job_id "
    }
}
{
    "_class": "com.zwayam.mongodb.models.CommonQueries",
    "companyId": "14977",
    "queryName": "IndentReport",
    "batchLimit": 5000,
    "query": "SELECT j.reference_number AS 'Indent Id', ( SELECT GROUP_CONCAT(DISTINCT u.username) FROM c3_job_collaboration c JOIN c3_user u ON u.id = c.user_id WHERE c.job_id = j.id GROUP BY j.id ) AS 'Collaborator', ( CASE WHEN j.is_requisition = 'Y' THEN ( SELECT username FROM c3_user WHERE id = j.created_by LIMIT 1 ) ELSE 'Not Available' END ) AS 'Req Created By', ( CASE WHEN j.is_requisition = 'Y' THEN ( SELECT username FROM c3_user WHERE id = j.requisition_approved_by LIMIT 1 ) ELSE 'Not Available' END ) AS 'Req Approved By', ( CASE WHEN j.is_requisition = 'Y' THEN DATE_FORMAT(j.requisition_approved_date, '%d-%m-%Y %r') ELSE 'Not Available' END ) AS 'Req Approved On', j.recruiter_name AS 'Recruiter Name', j.job_code AS 'Job Code', j.job_title AS 'Job Title', DATE_FORMAT(j.created_date, '%d-%m-%Y %r') AS 'Created Date', j.location AS 'Location', j.min_yrs_of_experience AS 'Min Experience', j.max_yrs_of_experience AS 'Max Experience', j.skill_set AS 'Skills', j.desired_skill AS 'Desired Skills',( SELECT rfv.value FROM c3_requisition_field_values rfv INNER JOIN c3_requisition_fields rf ON rfv.requisition_field_id = rf.id AND rf.field_name = 'Organization Unit' WHERE rfv.requisition_id = j.id LIMIT 1 ) AS 'Organization Unit', ( SELECT rfv.value FROM c3_requisition_field_values rfv INNER JOIN c3_requisition_fields rf ON rfv.requisition_field_id = rf.id AND rf.field_name = 'Business Unit' WHERE rfv.requisition_id = j.id LIMIT 1 ) AS 'Business Unit', ( SELECT rfv.value FROM c3_requisition_field_values rfv INNER JOIN c3_requisition_fields rf ON rfv.requisition_field_id = rf.id AND rf.field_name = 'Department Unit' WHERE rfv.requisition_id = j.id LIMIT 1 ) AS 'Department Unit', j.designation AS 'Designation', j.positions_req AS 'Open Positions', j.qualification AS 'Qualification', j.salary AS 'Salary', ( CASE WHEN j.job_visibilty = 'N' THEN 'Normal' WHEN j.job_visibilty = 'L' THEN 'Limited' WHEN j.job_visibilty = 'P' THEN 'Private' WHEN j.job_visibilty = 'E' THEN 'Enhanced' ELSE 'Normal' END ) AS 'Job Visibility', ( SELECT username FROM c3_user WHERE id = j.modified_by_user_id LIMIT 1 ) AS 'Modified By', DATE_FORMAT(j.modified_date, '%d-%m-%Y %r') AS 'Modified Date', ( SELECT username FROM c3_user WHERE id = j.created_by LIMIT 1 ) 'Created By', ( CASE WHEN j.status = 1 AND j.is_requisition = 'N' THEN 'Open' WHEN j.status = 2 AND j.is_requisition = 'N' THEN 'Hidden' WHEN j.is_requisition = 'Y' AND j.job_type = 'R' THEN 'Pending Requisition' WHEN j.status = 1 AND j.is_requisition = 'Y' AND j.job_type = 'J' THEN 'Open' ELSE 'Closed' END ) AS 'Job Status', COUNT(ja.id) AS 'Total Applies', COUNT( CASE WHEN ja.final_recommendation = 'Shortlist' THEN ja.id END ) AS 'Recommended', COUNT( CASE WHEN ja.current_status = 'Pending' THEN ja.id END ) AS 'Pending', COUNT( CASE WHEN ja.current_status = 'Recruiter Screening Selected' THEN ja.id END ) AS 'Shortlisted', COUNT( CASE WHEN ja.current_status = 'Rejected' THEN ja.id END ) AS 'Rejected', COUNT( CASE WHEN ja.current_status = 'Final Selected' THEN ja.id END ) AS 'Final Selected', COUNT( CASE WHEN ja.current_status = 'On Hold' THEN ja.id END ) AS 'On Hold', COUNT( CASE WHEN ja.current_status = 'Documents Requested' THEN ja.id END ) AS 'Documents Requested', COUNT( CASE WHEN ja.current_status = 'Interview Canceled' THEN ja.id END ) AS 'Interview Canceled', COUNT( CASE WHEN ja.current_status = 'Interview Selected' THEN ja.id END ) AS 'Interview Selected', COUNT( CASE WHEN ja.current_status = 'Interview Rejected' THEN ja.id END ) AS 'Interview Rejected', COUNT( CASE WHEN ja.current_status = 'Offer Made' THEN ja.id END ) AS 'Offer Made', COUNT( CASE WHEN ja.current_status = 'Offer Sent' THEN ja.id END ) AS 'Offer Sent', COUNT( CASE WHEN ja.current_status = 'Offer Accepted' THEN ja.id END ) AS 'Offer Accepted', COUNT( CASE WHEN ja.current_status = 'Offer Rejected' THEN ja.id END ) AS 'Offer Rejected', COUNT( CASE WHEN ja.current_status = 'Offer Revoked' THEN ja.id END ) AS 'Offer Revoked', ( SELECT department_name FROM c3_department WHERE id = j.department_id LIMIT 1 ) AS 'Department', REPLACE(j.deptFullCode, '.', '/') AS 'Dept Structure', ( CASE WHEN ( SELECT COUNT(jv.id) FROM c3_job_vendor_distribution jv WHERE j.id = jv.job_id LIMIT 1 ) > 0 THEN 'Yes' ELSE 'No' END ) AS 'Partner Enabled', ( CASE WHEN ( SELECT referralEnabled FROM c3_job_employee_distribution WHERE job_id = j.id LIMIT 1 ) = 1 THEN 'Yes' ELSE 'No' END ) AS 'Refferal Enabled', ( CASE WHEN ( SELECT IjpEnabled FROM c3_job_employee_distribution WHERE job_id = j.id LIMIT 1 ) = 1 THEN 'Yes' ELSE 'No' END ) AS 'Internal Job Posting', ( SELECT rfv.value FROM c3_requisition_field_values rfv JOIN c3_requisition_fields rf ON rfv.requisition_field_id = rf.id AND rf.field_name LIKE '%Requisition Type%' WHERE rfv.requisition_id = j.id LIMIT 1 ) AS 'Requisition Type' FROM c3_job j LEFT JOIN c3_job_application ja ON ja.job_id = j.id $conditions$ GROUP BY j.id ORDER BY ja.id",
    "conditions": "WHERE j.company_id = $companyId$ AND j.is_requisition = 'Y' and  ((j.department_id IN (SELECT DISTINCT Department.id FROM c3_department Department, UserRoleGroup UserRoleGroup WHERE UserRoleGroup.user_id = $userId$ AND UserRoleGroup.companyId = $companyId$ AND Department.company_id = $companyId$ AND UserRoleGroup.roleCode IN (SELECT DISTINCT Role.roleCode FROM Role Role, UserRoleRightDefinition UserRoleRightDefinition WHERE Role.roleCode IN (UserRoleRightDefinition.roleCode) AND Role.companyId = $companyId$ AND Role.scope = 'Department') AND Department.departmentFullcode LIKE CONCAT(UserRoleGroup.deptFullCode, '%')) or j.id in (select job_id from c3_job_collaboration where user_id=$userId$)) or j.company_id = (select companyId from UserRoleGroup where user_id= $userId$ and roleCode = 'Analytics Team'))",
    "filterConditions": {
        "fromDate": "j.created_date >= '$fromDate$' ",
        "toDate": "j.created_date <= '$toDate$' ",
        "department": " j.deptFullCode in ($department$) ",
        "location": "j.location in ($location$) ",
        "hiringManager": "j.hiring_manager in ($hiringManager$) ",
        "recruiter": "jcol.user_id in ($recruiter$) "
    },
    "joiningTables": {
        "c3_job_collaboration": " join c3_job_collaboration jcol on j.id = jcol.job_id "
    },
    "fileName": "IndentReport.csv",
    "displayName": "Indent Report (.csv)"
}